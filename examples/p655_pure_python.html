

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Reducing p655 in Pure Python &mdash; pylook 0.0.post63 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Running the P655 Reduction File" href="p655_run_r_file.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> pylook
          

          
          </a>

          
            
            
              <div class="version">
                0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Reference Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="p655_run_r_file.html">Running the P655 Reduction File</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Reducing p655 in Pure Python</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pylook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>Reducing p655 in Pure Python</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/p655_pure_python.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-examples-p655-pure-python-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="reducing-p655-in-pure-python">
<span id="sphx-glr-examples-p655-pure-python-py"></span><h1>Reducing p655 in Pure Python<a class="headerlink" href="#reducing-p655-in-pure-python" title="Permalink to this headline">¶</a></h1>
<p>Experiment p655 was run in 2005 by Mckiernan, Rathbun, and Rowe. It was reduced by
Chris Marone. Here we use the xlook r file parser to run that r file and then get it into the
dictionary of quantity arrays like we use everywhere else and do some simple plotting
of the experiment.</p>
<p>For the curious, this experiment is determining the frictional response of “Ghost Rocks”
from Kodiak Alaska.</p>
<p>While being able to run r files is great, we’d like to move to reducing the data in Python
to really get at the full power of pylook. There are lots of ways that pylook can simplify
reduction and it is easier to follow exactly what is happening for those unfamiliar with the
r file format.</p>
<p>Let’s start out with some imports to get rolling.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pylook.units</span> <span class="kn">import</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a>
<span class="kn">import</span> <span class="nn">pylook.calc</span> <span class="k">as</span> <span class="nn">lc</span>
<span class="kn">from</span> <span class="nn">pylook.cbook</span> <span class="kn">import</span> <span class="n">get_test_data</span>
<span class="kn">from</span> <span class="nn">pylook.io</span> <span class="kn">import</span> <a href="../api/generated/pylook.io.read_binary.html#pylook.io.read_binary" title="pylook.io.read_binary" class="sphx-glr-backref-module-pylook-io sphx-glr-backref-type-py-function"><span class="n">read_binary</span></a>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">get_test_data</span><span class="p">(</span><span class="s1">&#39;p655intact100l&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <a href="../api/generated/pylook.io.read_binary.html#pylook.io.read_binary" title="pylook.io.read_binary" class="sphx-glr-backref-module-pylook-io sphx-glr-backref-type-py-function"><span class="n">read_binary</span></a><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
</pre></div>
</div>
<p>The time column in these data files is really the sample rate in Hz. We want to turn that
into a delta time and cumulatively sum to get experiment elapsed time. Notice that we are
assigning units by multiplying them - easy! We have to take the magnitude of time for
<cite>cumsum</cite> because numpy silently drops our units. We’ll fix that with a <cite>cumsum</cite> wrapper
in pylook soon.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we need to apply calibrations and units to the data - the calibrations are determined
based on the sensor used by the experimentalist. We’ll get a list of the current data column
names so we know what they are called in the look file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;rec_num&#39;, &#39;Time&#39;, &#39;Vert_Disp&#39;, &#39;Vert_Load&#39;, &#39;Hor_Disp&#39;, &#39;Hor_Load.&#39;])
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Vert_Disp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Vert_Disp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.076472</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;micron / bit&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Vert_Load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Vert_Load&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.597778959e-3</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;MPa / bit&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Hor_Disp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Hor_Disp&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.11017176</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;micron / bit&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Hor_Load.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Hor_Load.&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">3.31712805707e-3</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;MPa / bit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now that calibrations are applied, we really should rename those columns to something more</span>
<span class="c1"># useful. Look limited the length of column names, but pylook does not. We even allow spaces!</span>
<span class="c1"># The `pop` method removes that key/value pair from the dictionary and we reassign it to a</span>
<span class="c1"># new key.</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Vert_Disp&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Vert_Load&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Hor_Disp&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Hor_Load.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There was a spike in the data that the experimentalist decided to remove. We can do that
with an offset that sets everything in between the rows to the final value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.remove_offset.html#pylook.calc.remove_offset" title="pylook.calc.remove_offset" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">remove_offset</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">],</span> <span class="mi">4075</span><span class="p">,</span> <span class="mi">4089</span><span class="p">,</span> <span class="n">set_between</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The testing machine expands when loading because it has a finite stiffness. That stiffness
is known and can be removed from the data to create an elastically corrected displacement.
Python is great with units here and can help you calculate the stiffness in the right units.
We know the stiffness is 0.37 kN/micron and this experiment use samples that were 5x5cm.
From that we let the units library do all of the hard work of calculating the stiffness in
terms of stress.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">normal_stiffness</span> <span class="o">=</span> <span class="mf">0.37</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;kN/micron&#39;</span><span class="p">)</span>
<span class="n">sample_normal_area</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<span class="n">normal_stiffness</span> <span class="o">=</span> <span class="n">sample_normal_area</span> <span class="o">/</span> <span class="n">normal_stiffness</span>
<span class="nb">print</span><span class="p">(</span><span class="n">normal_stiffness</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;micron/MPa&#39;</span><span class="p">))</span>  <span class="c1"># To just displays things in units that we expect</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>6.756756756756758 micron / megapascal
</pre></div>
</div>
<p>pylook’s elastic correction is a polynomial tool, so you can use as many coefficients as
you’d like. Just like <cite>np.polyval</cite> we expect coefficients from the highest order to lowest.
Units matter!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.elastic_correction.html#pylook.calc.elastic_correction" title="pylook.calc.elastic_correction" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">elastic_correction</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Stress&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">],</span>
                                                    <span class="p">[</span><span class="n">normal_stiffness</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;micron&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>We start recording data before there is any load on the samples, so we need to find where
the load is brought on. Easiest way to do this is to make a quick plot and find the row
number at which we want to zero things. The <cite>.m</cite> after the data is a way to drop units
(the magnitude) and is required as currently bokeh does not play well with units.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">gridplot</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span>

<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Find the normal stress zero row&#39;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="s1">&#39;box_zoom, reset, hover&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rec_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Stress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Row 42 looks pretty good, so we zero the normal stress there. We’d also like to set
everything before that row to zero since it’s just noise. In r files that took some math
commands, we zero has options in pylook! We also don’t need to worry about adding small
values to avoid divide by zero errors as the friction calculation handles that properly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Stress&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.zero.html#pylook.calc.zero" title="pylook.calc.zero" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">zero</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Stress&#39;</span><span class="p">],</span> <span class="mi">42</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>While we are zeroing, it is a good time to deal with the normal displacement as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.remove_offset.html#pylook.calc.remove_offset" title="pylook.calc.remove_offset" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">remove_offset</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span>
                                               <span class="n">set_between</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we need to find the zero point for the shear load and stress.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Find the shear stress zero row&#39;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="s1">&#39;box_zoom, reset, hover&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rec_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Row 1518 looks like a reasonable choice - so lets’ zero those two and zero everything
before then.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.zero.html#pylook.calc.zero" title="pylook.calc.zero" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">zero</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">],</span> <span class="mi">1518</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.zero.html#pylook.calc.zero" title="pylook.calc.zero" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">zero</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">],</span> <span class="mi">1518</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The displacement transducer on the shear axis often runs out of travel and has to be reset
during the experiment. We need to find those spots and record the rows at which those
offsets start and stop so we can remove them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Find the DCDT offsets&#39;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="s1">&#39;box_zoom, reset, hover&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rec_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Looks like we had two offsets - rows 18593 to 19058 and rows 66262 to 67830.
Let’s remove those and set the values between to the final value to that data look nice.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.remove_offset.html#pylook.calc.remove_offset" title="pylook.calc.remove_offset" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">remove_offset</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">],</span> <span class="mi">18593</span><span class="p">,</span> <span class="mi">19058</span><span class="p">,</span> <span class="n">set_between</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.remove_offset.html#pylook.calc.remove_offset" title="pylook.calc.remove_offset" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">remove_offset</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">],</span> <span class="mi">66262</span><span class="p">,</span> <span class="mi">67830</span><span class="p">,</span> <span class="n">set_between</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>For the normal displacement we assume that half of it is in each of the two layers of a
double direct setup. We are going to change the sign such that compaction shows a thinner
layer and dialation shows a thicker layer. On the bench the blocks were 89.2 mm thick with
a 4 mm gouge layer. Notice that because of the units awareness we can just add 4 mm and the
math works!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;dimensionless&#39;</span><span class="p">))</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.zero.html#pylook.calc.zero" title="pylook.calc.zero" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">zero</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">],</span> <span class="mi">42</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Displacement&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">(</span><span class="s1">&#39;mm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s calculate simple friction (shear stress / normal stress). We have a function in pylook
that does this intelligently handling divide by zeros when there is no shear stress on the
sample</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Friction&#39;</span><span class="p">]</span> <span class="o">=</span> <a href="../api/generated/pylook.calc.friction.html#pylook.calc.friction" title="pylook.calc.friction" class="sphx-glr-backref-module-pylook-calc sphx-glr-backref-type-py-function"><span class="n">lc</span><span class="o">.</span><span class="n">friction</span></a><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Normal Stress&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>## Quick Look
We’ll use Bokeh to take a quick look at the data. Matplotlib is the best choice for your
publication plots, but the speed and interactivity of Bokeh in the notebook is hard to beat.
We’ll be adding helpers to pylook to make this process easier in the future as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a handy function that will be integrated into pylook in a more advanced way soon,</span>
<span class="c1"># but demonstrates how to make a flexible plotting function instead of copying and pasting a</span>
<span class="c1"># bunch of code over and over again.</span>

<span class="k">def</span> <span class="nf">make_runplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x_var</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="s1">&#39;pan,wheel_zoom,box_zoom,reset,save,box_select,hover&#39;</span><span class="p">):</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">col_name</span> <span class="o">==</span> <span class="n">x_var</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">y_vars</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">y_vars</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="c1"># First plot is simple, the rest we share the x range with the first</span>
        <span class="k">if</span> <span class="n">plots</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">col_name</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">col_name</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_range</span><span class="p">)</span>

        <span class="c1"># Plot the data and set the labels</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">x_var</span><span class="p">]</span><span class="o">.</span><a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><a href="../api/generated/pylook.units.html#pylook.units.units" title="pylook.units.units" class="sphx-glr-backref-module-pylook-units sphx-glr-backref-type-py-attribute"><span class="n">units</span></a><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">x_var</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

        <span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="n">gridplot</span><span class="p">(</span><span class="n">plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plot_width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">175</span><span class="p">))</span>
</pre></div>
</div>
<p>By default make_runplot would plot all of the variables, let’s just plot a couple of basic
ones. Hover over the graph to see the values! That can be turned off by clicking the message
bubble icon in the plot toolbar. If we don’t specify, data are plotted with respect to time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make_runplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">,</span> <span class="s1">&#39;Normal Stress&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>We can specify to plot relative to another x variable though - with load point displacement
probably being the most common.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make_runplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">x_var</span><span class="o">=</span><span class="s1">&#39;Shear Displacement&#39;</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Shear Stress&#39;</span><span class="p">,</span> <span class="s1">&#39;Normal Stress&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Easy right? We’ll be adding more features to reduce this code even further, but it moves us
even further towards the goal of easy to understand and portable reductions that require a
minimum of installation and learning pain. Being in Python also means we can seamlessly
transfer these data into machine learning tools or just about any other analysis library
you’re interested in!</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  1.675 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-examples-p655-pure-python-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/96192b0e365c480274f1f14c6e4faa20/p655_pure_python.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">p655_pure_python.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/dd46ed4d80fdc961898b020ee28285f2/p655_pure_python.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">p655_pure_python.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="p655_run_r_file.html" class="btn btn-neutral float-left" title="Running the P655 Reduction File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Leeman Geophysical LLC

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>